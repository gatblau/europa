---
- name: Creating the {{group|capitalize}} user group
  group: name="{{group}}" state=present

- name: Creating the {{user|capitalize}} user
  user: name="{{user}}" group="{{group}}"

- name: Copying proxy management functions to host
  copy:
    src=shell/proxy.sh
    dest=/tmp/proxy.sh

- name: Adding proxy management functions to the shell
  shell: cat /tmp/proxy.sh >> .bashrc
  args:
    chdir: /home/{{user}}/

- name: Setting Banner Text with version in Login Screen
  template:
    src=roles/europa/templates/01-banner-message.j2
    dest=/etc/dconf/db/gdm.d/01-banner-message
  tags: gnome

- include: logo.yml
  tags: gnome

- name: Installing Unzip command
  yum: name=unzip state=present

- include: rpm.yml
  vars:
    rpm_app_name: "EPEL YUM Repository"
    rpm_filename : epel-release-7-5.noarch.rpm

- name: Installs Yum Utils
  yum:
    name=yum-utils
    state=present

- include: xscreensaver.yml

- name: Setting up NodeSource YUM repository
  script: node/setup-node-repo.sh

- name: Installing NodeJS
  yum:
    name=nodejs
    state=present

- name: Installing Bower
  command: "npm install -g bower"

- include: background.yml

- include: rpm.yml
  vars:
    rpm_app_name: "Java JDK 8u72-x64"
    rpm_filename : jdk-8u72-linux-x64.rpm

- name: Installing Java Alternative
  command: "alternatives --install /usr/bin/java java /usr/java/default/bin/java 1"

- name: Setting Java Alternative
  command: "alternatives --set java /usr/java/default/bin/java"

- include: rpm.yml
  vars:
    rpm_app_name: DOCKER
    rpm_filename: docker-1.8.2-10.el7.centos.x86_64.rpm

- name: Starting the Docker daemon
  service:
    name=docker
    state=started
    enabled=yes

- name: Updating the user bash profile to elevate rights to run Docker
  lineinfile:
    dest=/home/{{user}}/.bash_profile
    insertafter="# User specific.*"
    line="sudo chmod 0666 /var/run/docker.sock"

- name: Installing Python Package Manager (pip)
  yum:
    name=python-pip
    state=present

- name: Installing Docker Compose
  pip:
    name=docker-compose

- include: rpm.yml
  vars:
    rpm_app_name: GIT yum repository
    rpm_filename: wandisco-git-release-7-2.noarch.rpm

- include: rpm.yml
  vars:
    rpm_app_name: GIT_PERL
    rpm_filename: perl-Git-2.7.0-1.WANdisco.284.noarch.rpm

- include: rpm.yml
  vars:
    rpm_app_name: GIT_SCM
    rpm_filename: git-2.7.0-1.WANdisco.284.x86_64.rpm

- include: tool.yml
  vars:
    tool_name : Groovy
    folder_name : groovy-2.4.5
    zip_filename: apache-groovy-binary-2.4.5.zip
    add_version_to_folder : false
    zip_has_folder : true
    has_bin_folder : true

- include: rpm.yml
  vars:
    rpm_app_name: Vagrant
    rpm_filename: vagrant_1.8.1_x86_64.rpm

- include: rpm.yml
  vars:
    rpm_app_name: "Chrome Browser"
    rpm_filename : google-chrome-stable_current_x86_64.rpm

- include: tool.yml
  vars:
    tool_name : SBT
    folder_name : sbt-0.13.9
    zip_filename: sbt-0.13.9.zip
    add_version_to_folder : true
    zip_has_folder : true
    has_bin_folder : true

- include: tool.yml
  vars:
    tool_name : Gradle
    folder_name : gradle-2.10
    zip_filename: gradle-2.10-bin.zip
    add_version_to_folder : false
    zip_has_folder : true
    has_bin_folder : true

- include: tool.yml
  vars:
    tool_name : Maven
    folder_name : apache-maven-3.3.9
    zip_filename: apache-maven-3.3.9-bin.zip
    add_version_to_folder : false
    zip_has_folder : true
    has_bin_folder : true

- include: tool.yml
  vars:
    tool_name : Activator
    folder_name : activator-dist-1.3.7
    zip_filename: typesafe-activator-1.3.7.zip
    zip_has_folder : true
    add_version_to_folder : false
    has_bin_folder : false

- name: Making activator executable
  file: path=/usr/local/activator/default/activator mode=a+x

- include: intellij.yml

- include: scalaide.yml
  vars:
    zip_filename: scala-SDK-4.3.0-vfinal-2.11-linux.gtk.x86_64.tar.gz

- include: eclipse.yml
  vars:
    zip_filename: eclipse-jee-mars-R-linux-gtk-x86_64.tar.gz

- include: haroopad.yml
  vars:
    tool_name: HarooPad
    zip_filename: haroopad-v0.13.1-x64.tar.gz

- include: rpm.yml
  vars:
    rpm_app_name: "My SQL Workbench"
    rpm_filename: mysql-workbench-community-6.3.6-2.el7.x86_64.rpm

- include: tool.yml
  vars:
    tool_name : Robomongo
    folder_name : robomongo-0.9.0-rc4-linux-x86_64-8c830b6
    zip_filename: robomongo-0.9.0-rc4-linux-x86_64-8c830b6.tar.gz
    add_version_to_folder : false
    zip_has_folder : true
    has_bin_folder : true

- name: Removing the ansible installation folder
  file:
    dest=/tmp/packer-provisioner-ansible-local
    state=absent
  ignore_errors: yes