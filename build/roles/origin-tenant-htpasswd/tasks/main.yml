---
- name: Checking httpd-tools are installed
  yum:
    name: httpd-tools

- name: Adding namespaces to the tenant
  command: "{{ oc }} new-project {{ tenant.name }}-{{ item.tag }} --description={{ item.description }}"
  with_items: "{{ tenant.projects }}"

- name: Copying new-user script
  copy:
    src: "new-user.sh"
    dest: "{{ oc_path }}/new-user.sh"
    mode: "u+rw,g-wx,o-rwx"

- name: Adding users
  command: "sh {{ oc_path }}/new-user.sh {{ pwd_len }} {{ oc_path }} {{ item[0].name }} {{ tenant.name }}-{{ item[1].tag }} {{ item[0].isadmin }}"
  with_nested:
    - "{{ users }}"
    - "{{ tenant.projects }}"

- name: Copying resource quotas template
  template:
    src: "resource-quota.yml"
    dest: "{{ oc_path }}/resource-quota.yml"

- name: Applying resource quotas
  command: "{{ oc }} create -f {{ oc_path }}/resource-quota.json -n {{ tenant.name }}-{{ item }}"
  with_items: "{{ tenant.projects }}"
