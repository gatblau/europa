---
- name: Checking httpd-tools are installed
  yum:
    name: httpd-tools

- name: Copying new-user script
  copy:
    src: "new-user.sh"
    dest: "{{ oc }}/new-user.sh"

- name: Adding users
  command: "sh {{ oc }}/new-user.sh {{ pwd_len }} {{ oc }} {{ item[0].name }} {{ tenant.name }}-{{ item[1].tag }} {{ item[0].isadmin }}"
  with_nested:
    - "{{ users }}"
    - "{{ tenant.projects }}"

- name: Cpying resource quotas template
  template:
    src: "resource-quota.yml"
    dest: "{{ oc_path }}/resource-quota.yml"

- name: Applies resource quotas
  command: "{{ oc }} create -f {{ oc_path }}/resource-quota.json -n {{ tenant.name }}-{{ item }}"
  with_items: "{{ tenant.projects }}"
